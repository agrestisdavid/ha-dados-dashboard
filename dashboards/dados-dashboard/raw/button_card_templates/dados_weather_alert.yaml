dados_weather_alert:
  template: dados_base
  variables:
    entity: binary_sensor.meteoalarm
    state_display_entity: null
    card_color: var(--contrast2)
    card_height: 80px
    card_border_radius: 36px
    card_overflow: hidden
    img_cell_background: var(--green)
    show_glow: true

    lvl1: var(--green)
    lvl2: var(--yellow)
    lvl3: var(--orange)
    lvl4: var(--red)
  name: |
    [[[
      const fn = entity?.attributes?.headline || 'Wetterwarnung';
      return fn;
    ]]]
  state_display: |
    [[[
      return entity?.attributes?.description || 'Keine Warnung';
    ]]]
  icon: |
    [[[
      const raw = String(entity?.attributes?.awareness_type ?? '').toLowerCase();
      const type = raw.includes(';') ? raw.split(';')[1].trim() : raw.trim();

      const map = {
        'wind': 'mdi:weather-windy',
        'snow-ice': 'mdi:weather-snowy',
        'thunderstorm': 'mdi:weather-lightning',
        'fog': 'mdi:weather-fog',
        'high-temperature': 'mdi:thermometer-high',
        'low-temperature': 'mdi:snowflake',
        'coastalevent': 'mdi:waves',
        'forest-fire': 'mdi:fire-alert',
        'avalanches': 'mdi:landslide',
        'rain': 'mdi:weather-rainy',
        'flooding': 'mdi:home-flood',
        'rain-flood': 'mdi:weather-pouring',
        'marine-hazard': 'mdi:ferry',
        'drought': 'mdi:water-off'
      };

      return map[type] || 'mdi:alert';
    ]]]

  tap_action:
    action: navigate
    navigation_path: '#wetter'
  state:
    - value: "off"
      icon: "[[[ return variables.icon_1 ]]]"
      styles:
        img_cell:
          - background: "[[[ return variables.lvl1 ]]]"
    - operator: template
      value: |
        [[[
          const a = entity?.attributes?.awareness_level;
          const n = parseInt(String(a).match(/\d+/)?.[0] ?? '0', 10);
          return entity?.state === 'on' && n === 1;
        ]]]
      styles:
        img_cell:
          - background: |
              [[[
                const c = entity?.attributes?.rgb_color;
                if (c) return `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)`;
                return variables?.lvl1 || 'var(--blue)';
              ]]]
          - box-shadow: |
              [[[
                const c = entity?.attributes?.rgb_color;
                const fbColor = variables?.lvl1 || 'var(--blue)';
                const colA = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)` : fbColor;
                const colB = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.8)` : fbColor;
                return `-75px -70px 70px 20px ${colA}, -35px -35px 70px 10px ${colB}`;
              ]]]
    - operator: template
      value: |
        [[[
          const a = entity?.attributes?.awareness_level;
          const n = parseInt(String(a).match(/\d+/)?.[0] ?? '0', 10);
          return entity?.state === 'on' && n === 2;
        ]]]
      styles:
        img_cell:
          - background: |
              [[[
                const c = entity?.attributes?.rgb_color;
                if (c) return `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)`;
                return variables?.lvl2 || 'var(--blue)';
              ]]]
          - box-shadow: |
              [[[
                const c = entity?.attributes?.rgb_color;
                const fbColor = variables?.lvl2 || 'var(--blue)';
                const colA = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)` : fbColor;
                const colB = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.8)` : fbColor;
                return `-75px -70px 70px 20px ${colA}, -35px -35px 70px 10px ${colB}`;
              ]]]
    - operator: template
      value: |
        [[[
          const a = entity?.attributes?.awareness_level;
          const n = parseInt(String(a).match(/\d+/)?.[0] ?? '0', 10);
          return entity?.state === 'on' && n === 3;
        ]]]
      styles:
        img_cell:
          - background: |
              [[[
                const c = entity?.attributes?.rgb_color;
                if (c) return `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)`;
                return variables?.lvl3 || 'var(--blue)';
              ]]]
          - box-shadow: |
              [[[
                const c = entity?.attributes?.rgb_color;
                const fbColor = variables?.lvl3 || 'var(--blue)';
                const colA = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)` : fbColor;
                const colB = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.8)` : fbColor;
                return `-75px -70px 70px 20px ${colA}, -35px -35px 70px 10px ${colB}`;
              ]]]
    - operator: template
      value: |
        [[[
          const a = entity?.attributes?.awareness_level;
          const n = parseInt(String(a).match(/\d+/)?.[0] ?? '0', 10);
          return entity?.state === 'on' && n === 4;
        ]]]
      styles:
        img_cell:
          - background: |
              [[[
                const c = entity?.attributes?.rgb_color;
                if (c) return `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)`;
                return variables?.lvl4 || 'var(--blue)';
              ]]]
          - box-shadow: |
              [[[
                const c = entity?.attributes?.rgb_color;
                const fbColor = variables?.lvl4 || 'var(--blue)';
                const colA = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)` : fbColor;
                const colB = c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.8)` : fbColor;
                return `-75px -70px 70px 20px ${colA}, -35px -35px 70px 10px ${colB}`;
              ]]]
  styles:
    state:
      - font-size: 12px
# test
